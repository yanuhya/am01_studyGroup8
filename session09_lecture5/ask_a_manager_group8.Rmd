```{r}
library(googlesheets4)
library(tidyverse)
library(janitor) 
library(skimr)
library(countrycode) # to clean up country names
library(broom)
library(car)
library(ggfortify)
```

Load the ask a manager data set

```{r}
ask_a_manager_2021 <- read_csv(here::here("data", "ask_a_manager_2021.csv"))
```
Skim the data set to see if there are any missing or duplicate values

```{r}
skimr::skim(ask_a_manager_2021)
```

We see that the complete rate of "other_monetary_comp" and "currency_other" is 0. Hence, we can get rid of these columns.

```{r}
ask_a_manager_2021 <- ask_a_manager_2021 %>%
  select( -other_monetary_comp, - currency_other)
```

Let us also filter out the data where industry, highest level of educatin, gender and race is NA

```{r}
ask_a_manager_2021 <- ask_a_manager_2021 %>%
  filter(!is.na(industry) & !is.na(highest_level_of_education_completed) & !is.na(gender) & !is.na(race))
```

Now, the only columns where we have missing data is additional_context_on_job_title, additional_context_on_income, state and city

```{r}
unique_country_values <- unique(ask_a_manager_2021$country) %>% as_tibble()
unique_country_values$country_code = NA
for(i in 1:nrow(unique_country_values)){
  countryToTidy = unique_country_values$value[i]
  unique_country_values$country_code[i] = countrycode(countryToTidy, origin = 'country.name', destination = 'iso3c')
}

```

```{r}
for(i in 1:nrow(unique_country_values)){
  if(is.na(unique_country_values$country_code[i])){
    if(unique_country_values$value[i] == "United  States" | 
    unique_country_values$value[i] == "United Statss" |
    unique_country_values$value[i] == "	USaa" |
    unique_country_values$value[i] == "us" |
    unique_country_values$value[i] == "United Stateds" |
    unique_country_values$value[i] == "U. S" |
    unique_country_values$value[i] == "Uniter Statez" |
    unique_country_values$value[i] == "united stated" |
    unique_country_values$value[i] == "United Sttes" |
    unique_country_values$value[i] == "Unitied States" |
    unique_country_values$value[i] == "USAB" |
    unique_country_values$value[i] == "Untied States" |
    unique_country_values$value[i] == "United Statues" |
    unique_country_values$value[i] == "United statew" |
    unique_country_values$value[i] == "The US" |
    unique_country_values$value[i] == "Unite States" |
    unique_country_values$value[i] == "The US" |
    unique_country_values$value[i] == "Unites states" |
    unique_country_values$value[i] == "United Stares" |
    unique_country_values$value[i] == "Uniteed States" |
    unique_country_values$value[i] == "USS" |
    unique_country_values$value[i] == "United Status" |
    unique_country_values$value[i] == "Uniyes States" |
    unique_country_values$value[i] == "Uniyed states" |
    unique_country_values$value[i] == "United Statees" |
    unique_country_values$value[i] == "United Statea" |
    unique_country_values$value[i] == "United Stattes" |
    unique_country_values$value[i] == "United Statesp" |
    unique_country_values$value[i] == "Unted States" |
    unique_country_values$value[i] == "United Sates of America" |
    unique_country_values$value[i] == "United States (I work from home and my clients are all over the US/Canada/PR" |
    unique_country_values$value[i] == "Worldwide (based in US but short term trips aroudn the world)" |
    unique_country_values$value[i] == "Uniited States" |
    unique_country_values$value[i] == "United Sates" |
    unique_country_values$value[i] == "U. S." |
    unique_country_values$value[i] == "Unites States" |
    unique_country_values$value[i] == "United Statws" |
    unique_country_values$value[i] == "USA-- Virgin Islands" |
    unique_country_values$value[i] == "United Stated" |
    unique_country_values$value[i] == "United State of America" |
    unique_country_values$value[i] == "America" |
    unique_country_values$value[i] == "United State" |
    unique_country_values$value[i] == "ISA" |
    unique_country_values$value[i] == "Unitef Stated" |
    unique_country_values$value[i] == "USaa" |
    unique_country_values$value[i] == "america" |
    unique_country_values$value[i] == "United States- Puerto Rico"|
    unique_country_values$value[i] == "ðŸ‡ºðŸ‡¸" |
    unique_country_values$value[i] == "USD"|
    unique_country_values$value[i] == "I work for a UAE-based organization, though I am personally in the US."|
    unique_country_values$value[i] == "United States- Puerto Rico"){
      unique_country_values$country_code[i] = "USA"
    }
    else if(unique_country_values$value[i] == "Scotland" |
            unique_country_values$value[i] == "England" |
            unique_country_values$value[i] == "England/UK" |
            unique_country_values$value[i] == "England, UK." |
            unique_country_values$value[i] == "United Kindom" |
            unique_country_values$value[i] == "	England, UK" |
            unique_country_values$value[i] == "UK (Northern Ireland)" |
            unique_country_values$value[i] == "UK for U.S. company" |
            unique_country_values$value[i] == "	England, UK" |
            unique_country_values$value[i] == "Northern Ireland" |
            unique_country_values$value[i] == "UK (England)" |
            unique_country_values$value[i] == "UK, remote" |
            unique_country_values$value[i] == "Scotland, UK" |
            unique_country_values$value[i] == "Unites kingdom" |
            unique_country_values$value[i] == "england" |
            unique_country_values$value[i] == "Wales, UK" |
            unique_country_values$value[i] == "UK, but for globally fully remote company" |
            unique_country_values$value[i] == "Englang" |
            unique_country_values$value[i] == "Wales" |
            unique_country_values$value[i] == "Wales (UK)" |
            unique_country_values$value[i] == "U.K. (northern England)" |
            uni == "England, UK") {
      unique_country_values$country_code[i] = "GBR"
    }
    else if(unique_country_values$value[i] == "Canadw" |
            unique_country_values$value[i] == "Can" |
            unique_country_values$value[i] == "Canda" |
            unique_country_values$value[i] == "Canada and USA" |
            unique_country_values$value[i] == "Csnada") {
      unique_country_values$country_code[i] = "CAN"
            }
  }
}
```


```{r}


unique_country_values_to_be_tidied <- unique_country_values %>%
  filter(is.na(country_code))
```

```{r}
for(i in 1:nrow(ask_a_manager_2021)){
  countryToTidy = ask_a_manager_2021$country[i]
  ask_a_manager_2021$country[i] = countrycode(countryToTidy, origin = 'country.name', destination = 'iso3c')
}
  
```

